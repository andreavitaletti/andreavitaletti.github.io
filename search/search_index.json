{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Andrea Vitaletti","text":"<p>Andrea Vitaletti Ph.D. in Computer Science. I am currently Associate professor @ Sapienza University of Rome. My research interests are focused on devising solutions where data are collected, analyzed, managed and valorized in distributed networks fostering a decentralized governance. In this context, I worked over time on IoT, Distributed Ledger Technologies, Federated Machine Learning and Verifiable Computation and I am currently teaching most of these topics @ Sapienza. I am particularly interested in exploring and  studying tradeoffs between data utility and privacy as well as between individual interests and collective ones. I co-authored more than 80 papers I have been involved in a number of EU projects as researcher, principal investigator and coordinator of the FET Open PLEASED. I am a maker and I have some successful experience in transfer of technology: I founded the spin-offs WLAB - sold in 2016 - and WSENSE - left in 2019. Since 2020 I have been teaching Digital Entreprenurship and I am happy that some of my students have founded a startup (e.g. iotilize.me and yeastime) Hobbies: sailing, cycling and paragliding \u2026 I play the piano and the guitar for fun\u2026 be aware!</p>"},{"location":"#education","title":"Education","text":"From To Nov. 1998 Jan. 2002 PhD in Engineering in Computer Science (Dottorato di Ricerca in Ingegneria Informatica), University of Rome \u201cLa Sapienza\u201d Oct. 1992 Feb. 1998 MSc in Engineering in Computer Science (Laurea in Ingegneria Informatica), University of Rome \u201cLa Sapienza\u201d"},{"location":"#work-experience","title":"Work Experience","text":"From To Dec. 2019 Present Associate Professor at University of Rome \u201cLa Sapienza\u201d Nov. 2007 Nov. 2019 Assistant Professor (Ricercatore) University of Rome \u201cLa Sapienza\u201d Jul. 2007 Jun. 2019 Co-founder and CTO of WSENSE Jul. 2002 Jun. 2016 Co-founder and CTO of WLAB (exit: sold to Alten) Mar. 2002 Oct. 2007 Post-doc and research grant at University of Rome \u201cLa Sapienza\u201d Mar. 1998 Oct. 2007 Senior researcher at ETNOTEAM Research Labs (now NTT DATA) Mar. 2006 May. 2006 Visiting researcher at Swiss Federal Institute of Technology in Zurich (ETHZ), Zurich (Switzerland) Apr. 2001 Ago. 2001 Consultant at AT&amp;T Labs Research, Florham Park, NJ (USA)"},{"location":"#teaching","title":"Teaching","text":"<p>He teaches networking topics at Sapienza since 2008 in the Master and Bachelor in Computer Engineering (LM-32 and L-8). He is currently teaching   Internet of Things Application and Services (LM-32) and Advanced Information Security Systems and Blockchain for the Master in Cybersecurity (LM-66). Since 2000 he has been teaching a course on Digital Entrepreneurship; this is one among the very few joint courses organized between roman universities (Roma Tre and Sapienza, in particular). This course enjoys a strict collaboration with DOCK and some of the students attending the course have been awarded on the final DOCK context over the years (e.g. YEASTIME and IOTILZE.ME) and are now startup.</p> <p>From  2018 to 2023 he  gave a course on the Internet of Thing to the Master in Product Design at Sapienza (LM-12). </p> <p>Andrea Vitaletti is instructor in the MOOC of Sapienza on Coursera entitled \u201cRecovering the Humankind\u2019s Past and Saving the Universal Heritage\u201d (16545 enrolled, 4.4 star evaluation).</p> <p>25-29 September 2023. Data Science PhD course: Crypto and Incentive-based Mechanisms for Blockchain Technology. Togheter with Vangelis Markakis (University of Athens), Ivan Visconti (University of Salerno) and Philip Lazos (Input Output IOG, United Kingdom).</p> <p>A Short Course on IoT  taught at the University of Stellenbosch (South Africa) the 19th and 21st July 2023 during an Erasmus+ staff mobility for teaching visit. About 40 participants selected among more the 100 candidates. The second editino of the course was given in November 2024 at the Business and Technology University in Georgia.</p> <p>In 2023 and 2024 Instructor, togheter with prof. Paolo Merialdo of \u201cL\u2019imprenditoria digitale per la scuola\u201d (Digital Entrepreneurship for the school) by Fondazione i Lincei per la Scuola. </p>"},{"location":"#transfer-of-technology","title":"Transfer of Technology","text":"From To 2002 2016 In 2002 I founded WLAB, a dynamic SME created to support applied research and prototyping  in the area of wireless technologies and pervasive and mobile computing. WLAB has been characterized  by the synergy with the universities of Rome (Sapienza and Tor Vergata) promoting a continuous and  effective technological transfer of innovative solutions from academia to the industry.  I was Chief Technology Officer (CTO) of WLAB until its sale in 2016 2012 2019 In 2012 I founded WSENSE a spin-off of Sapienza University of Rome, with a strong and experienced R&amp;D  team specialized in monitoring and communication systems with pioneering patented solutions in the  Internet of Underwater Things (IoUT). I was the CTO of WSENSE and I lead the activities for the development  of the WGATE, the cloud platform for the collection, analysis, visualisation and integration of IoT data.  WSENSE is an international company, with WSENSE Ltd hosted in the Marine Robotics Innovation Centre of Southampton U.K. 2014 2020 Among the organizers of the Google Technologies Workshop for Cloud and Web Development now in its fifth edition.  The workshop is aimed at students to develop the skills leading them to the realization of a start-up.  The success of the workshop is also measured by the fact that some participants are now hosted in business accelerators in 2014 Successful experience in a crowd-funding campaign with the project COVA  that has been also bradcasted in the Italian main TV channel RAI in 2014 The WSN group @ DIAG I lead designed and developed the MagoNode: a new wireless device for WSN networks operating  in the 2.4Ghz ISM band deployed in many field trials. in 2001 During my stay at AT&amp;T Research Labs of Florham Park, NJ - USA, my research activity led to the application of  four provisional patent applications. in 2014 I gave a talk on my research activity at TEDXROMA 2019 today Member of the ADI committee in the reserch for business category"},{"location":"#patents","title":"Patents","text":"<ul> <li> <p>Patent 102003901105392 (RM2003A000177): Procedure for the recognition of authenticity of documents and debt securities, in particular banknotes, and related system.</p> </li> <li> <p>Patent 102001900950099 (RM2001A000492): Method for the secure transmission of data through short message service messages (SMS) with related methods for generating and recognizing secure SMS</p> </li> </ul>"},{"location":"#projects","title":"Projects","text":"<p>I have acquired a significant experience on research projects, gained in more than 15 years of participation to academic and industrial projects characterized in many cases by a marked multidisciplinarity approach. Over the time I assumed various roles, with different responsibilities, as researcher, principal investigator (PI) and finally coordinator.</p> <p>On going projects</p> <ul> <li> <p>Made in Italy Circolare e Sostenibile (MICS) National Plan for Recovery and Resilience NextGenerationEU (PNRR) program, SPOKE 8 Digitally-oriented factory design and management through AI and data driven approaches,  Project 8.06 Blockchain-based solutions for trusted and quality-aware data sharing</p> </li> <li> <p>SEcurity and RIghts in the CyberSpace SERICS National Plan for Recovery and Resilience NextGenerationEU (PNRR), SPOKE 9 Securing Digital Transformation,  Project Smart Decentralized Finance (SmartDeFi)</p> </li> <li> <p>ERASMUS-EDU-2022-CBHE project titled \u201cSmart City ASEAN Learning Network (SCALe)\u201d with project number: 101083278 </p> </li> </ul> <p>Past Projects</p> <ul> <li> <p>MISE (Ministry of Economic Development) Project. Copyright management on 5G network over Blockchain. The project is managed by SIAE, the Italian Collective Management Organization. I lead the activity of WP2 focused on the open research issues to implement a copyright management on blockchain</p> </li> <li> <p>Decentralised RObinson List. The project is managed by Fondazione Ugo Bordoni. This project won the Algorand Grand Prize at Future of Blockchain Competition.</p> </li> <li> <p>MISE (Ministry of Economic Development) Project. Smart Factory, Agrifood and Life Science. MaaS (Maintenance as a Service) platform based on the integrated use of IoT-Blockchain, for the inter-operational and transparent sharing of authenticated and protected information, regarding the enhancement and operational management in REAL time of technical ASSETS and economic transactions related to the interactions between the various parties involved in the entire Facility Management chain</p> </li> <li> <p>Sapienza Project on Blockchain and Public Administration.</p> </li> <li> <p>Erasmus+ Capacity Building in Higher Education: Master Degree in Industry 4.0 Project No.\u00a0610455-EPP-1-2019-1-MY-EPPKA2-CBHE-JP</p> </li> <li> <p>FP7-PEOPLE-ITN-2008 FRONTS (PI), Overall Budget: EUR 3.1 Mln. From 01-02-2008 to 30-04-2011. The aim of this project is to establish the foundations of adaptive networked societies of tiny heterogeneous artifacts. I participated to all the review meetings where I presented the activities of WP2.</p> </li> <li> <p>FP7-ICT-2009-5 VITRO (PI), Overall Budget: EUR 3.4 Mln. From 01-09-2010 to 28-02-2013. This project is focused on developing architectures, algorithms and engineering methods, to enable the realization of scalable, flexible, adaptive, energy-efficient and trust-aware Virtual Sensor Network platforms. I participated to all the review meetings where I presented the activities of WP3.</p> </li> <li> <p>ARTEMISI-JU call 2009, CHIRON (PI), Overall Budget: EUR 17.8 Mln. From 01-03-2010 to 01-02-2013. CHIRON combines state-of-the-art technologies and innovative solutions into an integrated framework for effective and person-centric health management throughout the complete (health)care cycle.</p> </li> <li> <p>EU EUROSTARS-EUREKA, PharmAID (PI), Overall Budget: EUR 2 Mln. From 01-06-2010 to 31-12-2012. The mainpurpos of the project is the development of an solution for the pharmaceutical market based on passive RFID tags capabe to: a) prevent drugs\u2019 counterfeiting; b) certify drugs\u2019 integrity; and c) track drugs along the whole supply chain. I participated to all the review meetings where I presented the activities of WP5.</p> </li> <li> <p>FP7-ICT-2011-C FET (Future Emerging Technology) OPEN, PLEASED (Coordinator), Overall Budget: EUR 1.46 Mln. From 01-05-2012 to 30-04-2015. Evaluated Excellent. In this project we develop a technology capable to interface and understand electrical signals gereated by plants in reaction to external stimuli. This is teh premise of the development of plant cyborgs. While artificial sensing devices exist that can monitor environmental parameters of interest, such as temperature or humidity, the focus of our research is the use of plants themselves as sensing and decision-making devices. The results of the multidisciplinary team in the project have obtained a significant eco in he media such as Youtube and Wired.</p> </li> <li> <p>EU FI-ADOPT, PAGE (Coordinator), Overall Budget: EUR 150 K. From 01-11-2014 to 01-11-2015. Evaluated Excellent. A project to develop a technology capable to effectively support elderly in their daily activities.</p> </li> <li> <p>FP7-ICT-2013-10. SUNRISE (I). Overall Budget: EUR 5.3 Mln. From 2013-09-01 to 2016-12-31. The SUNRISE main objective is the development of a federated underwater communication network, based on pilot infrastructures already designed, built and deployed by consortium partners, in diverse environments, web-accessible and interfaced with existing FIRE facilities to experiment with Future Internet technologies.</p> </li> <li> <p>EASME ARCHEOSUb (I) . The ARCHEOSUb (Autonomous underwater Robotic and sensing systems for Cultural Heritage discovery Conservation and in situ valorization) project aims at developing products and services to support the discovery, monitoring and protection of Underwater Cultural Heritage (UCH) sites.</p> </li> </ul> <p>Other earlier project activities</p> <ul> <li> <p>I was the technical manager of the DIAG group in Rome \u201cLa Sapienza\u201d for the project VICOM (Virtual Immersive COMmunications - http://www.vicom-project.it/). The project has developed the infrastructure for the provisioning of augmented realty mobile services. In particular, the group of Rome has developed the framework for the location of mobile users through heterogeneous technologies (GPS, CellID, WiFi, Sensor Networks \u2026)</p> </li> <li> <p>I was the coordinator and technical manager of the CINI lab in Rome. The lab participated in the FIRB project WEB, developing a framework for the remote access to multimedia context sensitive services (eg: tourist guides on mobile phones where the information is georeferenced).</p> </li> <li> <p>I collaborated with the group of Professor Chiara Petrioli within the European project EYES (Energy Efficient Sensor networks - http://www.eyes.eu.org/) for the creation of energy-efficient self-organizing sensor networks.</p> </li> <li> <p>I collaborated with the group of Professor Chiara Petrioli in the EU project WiSeNts (Wireless Sensor Networks and Cooperating Smart Objects). The project studied the main dynamics for the realization of complex systems of intelligent and cooperating objects (e.g.\u00a0sensor networks). As part of this project I visited the Swiss Federal Institute of Technology in Zurich (ETHZ) in 2006.</p> </li> <li> <p>I was a researcher in the European project AEOLUS (Algorithmic Principles for Building Efficient Overlay Computers - http://dmod.cs.uoi.gr/aeolus site / main.htm). The project investigated methods and algorithms for creating overlay networks for the efficient and transparent access to Internet resources.</p> </li> <li> <p>I was a researcher in the European project DELIS (Dynamically Evolving, Large-scale Information Systems - http://delis.upb.de/). The project has developed methods, techniques and tools to effectively manage modern information systems, characterized by large and extremely dynamic information.</p> </li> <li> <p>In the EU SOFIA project (Artemisia - https://www.artemisia-association.org/sofia), I was task leader for TASK3.3 in WP3. The SOFIA project has created a platform for interoperability between embedded systems in smart environments.                                                                                                                                                                             |</p> </li> </ul>"},{"location":"#research","title":"Research","text":"<p>The following figure shows the Wordcloud of the abstracts of my papers downloaded from Scopus and I think well capture the evolution of my research interests.</p> <p></p> <p>I initially focused on wireless networks for the collection of data to provide useful services to the users. This activity, is nowadays part of the wider research on the Internet of Things (IoT) and more recently naturally brought me to start an investigation on Decentralized Applications and Blockchain Technologies.</p> <p>A distinctive characteristics of my research is the attempt to always validate the performance of the proposed solutions, namely algorithms and protocols, both theoretically and practically.</p> <p>I lead the research activities on wireless sensor networks and the Internet of Things, in the research group on Computer Networks and Pervasive Systems of the Department of Automatic Computer Engineering and Management Antonio Ruberti della Sapienza University of Rome (DIAG). In this context, I enjoied the cooperation with several international research organizations, including: Research Academic Computer Technology Institute (Greece), Braunschweig University of Technology (Germany), Universitat Paderborn (Germany), University of Athens (Greece), Ben-Gurion University of the Negev (Israel), University of Salerno (Italy), Wroclaw University of Technology (Poland), Universitat Politecnica de Catalunya (Spain), University of Geneva (Switzerland), University of Lubeck (Germany).</p> <p>I founded the laboratory on the wireless sensor network at DIAG where the solutions - both hardware and software - designed in the our research activities, are implemented and tested in the field. In the lab, we developed and implemented the MagoNode: a new wireless device for WSN networks operating in the 2.4Ghz ISM band deployed in many field trials.</p> <p>I enjoy a long term collaboration on cooperative design and co-design with faculties of the MSc in Product Design at Sapienza. In particular, I\u2019m leading the research activities on the employment of genetic algorithms for product design.</p> <p>I am a member of the core group of the  Italian Distributed Ledger Technology Working Group. In 2024 I have been co-chair of the 6th Distributed Ledger Technologies Workshop (DLT2024) and I am guest editor of the special issue on <code>Emerging Trends in Distributed Ledger Technology and its Applications</code> on Blockchain: Research and Applications journal (Q1) </p> <p>From 2008 to 2017 I was member of the PhD board  in Computer Engineering @ Sapienza</p> <p>Since 2018 I am member of the PhD board  in Data Science @ Sapienza</p>"},{"location":"#publications","title":"Publications","text":"<p>Nowadays, the most updated way to access to the list of my publications is on </p> <ul> <li>Scopus</li> <li>Google Scholar</li> <li>DBLP</li> <li>ORCID</li> </ul> <p>I used the technique described here to  cluster my papers based on their abstracts. The result is shown in the following picture</p> <p></p> <p>I think this approach provides good results that well reflects my research over time. Papers are classified according to the opics  as shown in the following picture</p> <p></p> <p>The interactive graphs produced by the Colab notebook used to obtain these results is available here</p>"},{"location":"links/","title":"Links","text":"<ul> <li>A short course on IoT</li> <li>Un computer per tutti</li> </ul>"},{"location":"thesis/","title":"Thesis","text":"<p>These thesis are in collaboration with Ivan Visconti, Pierpaolo Della Monica, Marco Zecchini, Ioannis Chatzigiannakis, Daniel Mauricio Jimenez Gutierrez and Aris Anagnostopoulos</p>"},{"location":"thesis/#a-browser-plugin-to-validate-the-proof-of-a-legit-transformation-of-a-private-image-into-a-public-available-one-publicly-available-on-the-web","title":"A browser plugin to validate the proof of a legit transformation of a private image into a public available one publicly available on the Web","text":"<p>The Internet has plenty of public images that are transformations (e.g., resize, crop, grayscale) of original unpublished ones. Various reasons recommend to keep private an original image, such as its economic value and its sensitive content. Several concrete scenarios, including selling images over the Internet, fighting misinformation and detecting deep fakes, would highly benefit from a system allowing to efficiently prove and verify the authenticity of a transformed image (i.e., the public image is a result of a faithful transformation over a private and authentic original image). We have designed a system allowing the possessor of a signed private image to compute a faithful transformation, guaranteeing 1) confidentiality (no leak), 2) efficient proof generation (the proof can be computed with a cheap laptop), 3) integrity (only the advertised transformations have been applied) and 4) efficient fraud detection (fast detection of bogus proofs). Our system is based on a divide-et-impera approach through sub-transformations applied to tiles of the original image that are then reconnected together along with their sub-proofs. See Do Not Trust Anybody: ZK Proofs for Image Transformations Tile by Tile on Your Laptop on RWC and Trust Nobody: Privacy-Preserving Proofs for Edited Photos with Your Laptop.</p> <p>A detailed paper on the technical ingredients to develop the system will be provided </p>"},{"location":"thesis/#goal-of-the-thesis","title":"Goal of the thesis.","text":"<p>Develop a plugin for a browser capable to verify that the publicly available image shown in the browser is indeed obtained from a legit transformation of a private image owned by a possessor. Similarly to what happens in TLS, browsers show a closed lock when the communication is secure and the server is known, the plugin should show a symbol to show that the browser has validated the proof. </p>"},{"location":"thesis/#technical-ingredients","title":"Technical Ingredients:","text":"<p>The proof require some knowledge of Zero Knowledge Proofs and the tools to implement such proofs (e.g. Circom) as well as the capability to develop browser plugins. The thesis should also consider the compliance with the C2PA standard.</p>"},{"location":"thesis/#links","title":"Links","text":"<ul> <li>https://c2pa.org/</li> <li>https://chromewebstore.google.com/detail/c2pa-content-credentials/mjkaocdlpjmphfkjndocehcdhbigaafp</li> <li>https://contentcredentials.org/verify</li> <li>https://github.com/contentauth/c2patool?tab=readme-ov-file</li> <li>https://github.com/digimarc-corp/c2pa-content-credentials-extension</li> <li>https://github.com/contentauth/c2pa-js</li> <li>https://opensource.contentauthenticity.org/docs/manifest/manifest-examples/</li> <li>https://github.com/c2pa-org/public-testfiles/tree/main/image</li> </ul>"},{"location":"thesis/#conflict-free-replicated-data-in-web3-and-blockchain","title":"Conflict-Free Replicated Data in Web3 and Blockchain","text":"<p>Conflict-Free Replicated Data Type (CRDT) is a data structure which allows multiple replicas to be updated independently and concurrently without the need for synchronization. The key feature of CRDT is that it ensures strong eventual consistency across all replicas, making it a preferred solution for distributed databases and systems.</p> <p>Eventual Consistency is a guarantee that when an update is made in a distributed node, that update will eventually be reflected in all nodes that store the data, resulting in the same response every time the data is queried.</p> <p>CRDT have been used in nosql key-value databases such as REDIS, in decentralized social such as farcaster and reently they have been proposed to implement an Orderless Blockchain</p>"},{"location":"thesis/#goal-of-the-thesis_1","title":"Goal of the thesis","text":"<p>The thesis will first analyse the CRDT data structures and then it will focus in their employment in one of the above cited application domain (or even new ones) with the purpose of developing a PoC or improving current solutions</p>"},{"location":"thesis/#blockchain-for-the-circular-economy","title":"Blockchain for the Circular Economy","text":"<p>The circular economy is a model of production and consumption, which involves sharing, leasing, reusing, repairing, refurbishing and recycling existing materials and products as long as possible. In this way, the life cycle of products is extended. Keeping track of all those transformation in the state of materials and products is a key to support Circular Economy and Blockchain is claimed to be a reference solution both to keep track of such changes of state and to possibly facilitate the circular economy dispensing proper incentives to actors that behave properly. </p>"},{"location":"thesis/#goal-of-the-thesis_2","title":"Goal of the thesis","text":"<p>We are partner in the PNRR Made in Italy Circolare e Sostenibile MICS project. </p> <p>The purpose of the thesis is to develop a PoC on the employment of Blockchain Technologies to support the Circular Economy in the Made in Italy</p>"},{"location":"thesis/#federated-machine-learning-and-blockchain","title":"Federated Machine Learning and Blockchain","text":"<p>Federated learning(FML) is a decentralized approach to training machine learning models. It doesn't require an exchange of data from client devices to global servers. Instead, the raw data on edge devices is used to train the model locally, and share only model parameters thus increasing data privacy. At DIAG, we developed a FedArtML: A Tool to Facilitate the Generation of Non-IID Datasets in a Controlled Way to Support Federated Learning Research</p>"},{"location":"thesis/#goal-of-the-thesis_3","title":"Goal of the thesis","text":"<p>The thesis will investigate the integration of FML with Blockchain Technologies starting from the relevant literature. We are particularly interested in designing new tools and methodology to automatically incentive, by means of smart contracts, the contribution of each distributed node to the distillation of the global model. To this purpose, we first need to identify a privacy-preserving metric to evaluate the quality of the contribution without revealing the data. The problem of measuring the contribution of participants in FML has been investigated in WDZ19, however in that paper privacy has not been considered.</p> <p>Question</p> <p>Can we provide a Zero Knowledge Proof of the contribution of the participants in Federated Machine Learning?</p> <p>Question</p> <p>Can an actor claim a reward providing privacy-preserving evidence of its contribution without revealing a) its identity, but proving he/she is part of the actors contributing to the model b) its real contribution (e.g. the dataset, the parameters of the model), c) its received reward ?</p>"},{"location":"thesis/#blockchain-based-solutions-for-trusted-and-quality-aware-data-sharing","title":"Blockchain-based solutions for trusted and quality-aware data sharing","text":"<p>Monitoring business processes within complex supply chains demands efficient data collection and analytics tailored to diverse phenomena. Traditional centralized solutions face limitations in adapting to the dynamic nature of supply chains. This calls for distributed solutions which break the usual architectural assumption to have a central entity in charge of collecting, integrating and offering tools for the analysis.</p>"},{"location":"thesis/#goal-of-the-thesis_4","title":"Goal of the thesis","text":"<p>The thesis aims at develop tools and methodology to proofs in zero knowledge that sensitive business data are compliant to specific criteria- Since data are sensitive they cannot be disclosed (zero-knowledge), but the company is interested to provide formal evidences (i.e. proofs) that it is compliant to specific criteria and/or standards. As an example, given a public available reference vector of features, the company what to provide a proof that its private features are within a given distance (e.g. cosine similarity) from the reference vector. This can be done in Circom under suitable assumptions. </p>"},{"location":"BC/","title":"Blockchain","text":"<p>I don't want to reinvent the wheel ;-)</p> <p>An excellent source of information is the course Principles of Blockchains by professor Prof. Pramod Viswanath at University of Illinois Urbana-Champaign.</p> <p>Here I will try to adapt that material and elaborate on it. </p>"},{"location":"IoT/","title":"GOAL","text":"<p>This short course on the Internet of Things is designed to give a first understanding of the main issues in developing IoT solutions. We do believe the most efficient way to learn this subject is experimenting, this is way the course encourage attendants to hands-on. No specific background is needed, even if a basic knowledge of electronics and computer science might help. </p>"},{"location":"IoT/#session-1-4-hours","title":"SESSION 1 (4 hours)","text":"<p>GOAL: Quick intro to the Internet of Things.</p> <ul> <li>Introduction to the IoT</li> <li>IoT and Big Data: we can quantitatively measure phenomena that up to yesterday we were only able to guess</li> <li>A network of Resource Constrained Devices: if computational power, memory, energy, bandwidth and costs are not constrained, it is likely Internet, not Internet of Things.</li> </ul>"},{"location":"IoT/#session-2-4-hours","title":"SESSION 2 (4 hours)","text":"<p>GOAL: Small experiment (a single sensor). Prove you can integrate sensors suitable for you monitoring purpose.  Focus on effectiveness, namely doing the right things, i.e., the Maker approach.</p> <ul> <li>The reference hardware: ESP32</li> <li>Hands on with the Arduino Ide and Wokwi</li> <li>A simple integration of sensor/actuator</li> <li>Communicating over WiFi</li> </ul>"},{"location":"IoT/#session-3-4-hours","title":"SESSION 3 (4 hours)","text":"<p>GOAL: Small experiment (a single sensor). Focus on efficiency, namely doing the things right, i.e., the Engineers approach. Use metrics to measure to what extent your solution satisfies the user requirements.</p> <ul> <li>The need of an Operating System </li> <li>Hands on FREERTOS</li> <li>A simple integration of sensor/actuator</li> <li>Communicating over WiFi</li> </ul>"},{"location":"IoT/#session-4-4-hours","title":"SESSION 4 (4 hours)","text":"<p>GOAL: Scale-up in a realistic environment.</p> <ul> <li>The Very Large Scale IoT Testbed IoT-LAB </li> <li>FreeRTOS on IoT-lab</li> <li>A simple Project</li> </ul>"},{"location":"IoT/#tools-and-materials","title":"Tools and Materials","text":"<p>I like vscode with the Remote-SSH extension to interact with the virtual machine for FreeRTOS development. However, during the class there might be many issues due to different version of the OS and vscode. To further simplify the process I use micro a modern and intuitive terminal-based text editor. Give it a try, it is very convenient. I also suggest to install the file manager plugin. The only annoying issue I'm currently facing with micro is that copy/past does not work smoothly over SSH, you have to use ctr + shift + V</p>"},{"location":"IoT/#material","title":"Material","text":"<p>The list of material for each group: 1 ESP32-DevKit, a breadboard, some wires and resistors, one led, one button, one potentiometer and one 3 Axis Accelerometer Gyroscope</p> <ul> <li> <p>ESP32-DevKit e.g. Available on Amazon</p> </li> <li> <p>A breadboard e.g. Available on Amazon</p> </li> <li> <p>Wires e.g. Available on Amazon</p> </li> <li> <p>Resistors e.g. Available on Amazon</p> </li> <li> <p>Minimal actuator, namely a led and resistors - resistor 330 Ohm e.g. Available on Amazon</p> </li> <li> <p>Minimal analog sensor, namely a potentiometer 10 KOhm e.g. Available on Amazon</p> </li> <li> <p>Minimal digital sensor, namely a button - resistor 1 KOhm e.g. Available on Amazon</p> </li> <li> <p>A more interesting digital vibration sensor SW-420 e.g. Available on Amazon</p> </li> <li> <p>3 Axis Accelerometer Gyroscope Sensor Module GY-521 MPU6050 Modulee.g. Available on Amazon</p> </li> </ul>"},{"location":"IoT/#useful-links","title":"Useful links","text":"<ul> <li>Code and Slides</li> <li>The Espressif software development environment</li> <li>Arduino Ide</li> <li>Wokwi</li> <li>FREERTOS</li> <li>IoT-LAB </li> <li>Thingsboard</li> <li>Adafruit Io</li> <li>A short paper on this course</li> <li>Getting Started with ESP32</li> <li>Andreas Spiess Youtube channel</li> </ul>"},{"location":"IoT/#editions","title":"Editions","text":"<p>First edition of the course 19th (Session 1 and 2) and 21st (Session 3 and 4) of July 2023 in the University of Stellenbosch (South Africa) during an Erasmus+ staff mobility for teaching visit. About 40 participants selected among more the 100 candidates. </p> <p></p> <p>Second edition of the course 25th, 29th and 31st Of October and 4th of November 2024 in the Business and Technology University (Tbilisi, Georgia) during an Erasmus+ staff mobility for teaching visit. Two groups of 10 students each. </p> <p> </p>"},{"location":"IoT/iot-lab/","title":"IOT-LAB","text":""},{"location":"IoT/iot-lab/#run-a-lorawan-experiment","title":"Run a Lorawan experiment","text":"<pre><code>ssh vitalett@saclay.iot-lab.info \n</code></pre> <pre><code>git clone https://github.com/FreeRTOS/FreeRTOS-LTS.git\ncd FreeRTOS-LTS/FreeRTOS\ngit clone https://github.com/Lora-net/LoRaMac-node.git\ncd cd LoRaMac-node/\n</code></pre> <pre><code>nano  src/boards/B-L072Z-LRWAN1/board.c\n\n// change the baudrate to 115200 to be compatible with iot-lab serial \n\nUartConfig( &amp;Uart2, RX_TX, 115200, UART_8_BIT, UART_1_STOP_BIT, NO_PARITY, NO_FLOW_CTRL );\n</code></pre> <p><pre><code>nano src/peripherals/soft-se/se-identity.h\n\n// update credentials to connect to TTN\n#define STATIC_DEVICE_EUI       1\n#define LORAWAN_DEVICE_EUI      LORAWAN_DEVICE_EUI_ON_TTN\n#define LORAWAN_JOIN_EUI        LORAWAN_APP_EUI_ON_TTN\n#define STATIC_DEVICE_ADDRESS   1\n#define LORAWAN_DEVICE_ADDRESS  DEVICE_ADDRESS_TTN\n\n.KeyID = NWK_KEY,           \n.KeyValue = LORAWAN_APP_KEY_ON_TTN\n</code></pre> </p> <pre><code>mkdir build\ncd build\n\ncmake -DCMAKE_BUILD_TYPE=Release         -DTOOLCHAIN_PREFIX=\"/opt/gcc-arm-none-eabi-4_9-2015q1/\"      -DCMAKE_TOOLCHAIN_FILE=\"../cmake/toolchain-arm-none-eabi.cmake\"         -DAPPLICATION=\"LoRaMac\"         -DSUB_PROJECT=\"periodic-uplink-lpp\"         -DCLASSB_ENABLED=\"ON\"         -DACTIVE_REGION=\"LORAMAC_REGION_EU868\"         -DREGION_EU868=\"ON\"         -DREGION_US915=\"OFF\"         -DREGION_CN779=\"OFF\"         -DREGION_EU433=\"OFF\"         -DREGION_AU915=\"OFF\"         -DREGION_AS923=\"OFF\"         -DREGION_CN470=\"OFF\"         -DREGION_KR920=\"OFF\"         -DREGION_IN865=\"OFF\"         -DREGION_RU864=\"OFF\"         -DBOARD=\"B-L072Z-LRWAN1\"       -DSECURE_ELEMENT=\"SOFT_SE\"         -DSECURE_ELEMENT_PRE_PROVISIONED=\"OFF\"         -DUSE_RADIO_DEBUG=\"ON\" ..\n\nmake\n</code></pre> <pre><code>cd src/apps/LoRaMac/\n\niotlab-experiment submit -n rtos_ttn -d 60 -l 1,archi=st-lrwan1:sx1276+site=saclay\n{\n    \"id\": 394774\n}\n\niotlab-experiment get -i 394774 -s\n\niotlab-experiment get -i 394774 -r\n\niotlab-node --flash LoRaMac-periodic-uplink-lpp -l saclay,st-lrwan1,10\n\nnc st-lrwan1-10 20000\n</code></pre>"},{"location":"IoT/session1/","title":"SESSION 1","text":"<p>GOAL: Quick intro to the Internet of Things.</p>"},{"location":"IoT/session1/#takeaway-one","title":"Takeaway ONE","text":"<ul> <li>IoT is fuel for Big Data Analytics</li> <li> <p>\"When you can measure ... you know something\". Lord Kelvin docet.</p> </li> <li>IoT provide quantitative evidences on  phenomena that we used to investigate only qualitatively</li> </ul>"},{"location":"IoT/session1/#takeaway-two","title":"Takeaway TWO","text":"<ul> <li>IoT is a network of resource constrained devices</li> <li>Constraints require design choices</li> <li>Beyond the maker approach, namely when effectiveness meets efficiency</li> </ul>"},{"location":"IoT/session2/","title":"SESSION 2","text":"<p>GOAL: Small experiment (a single sensor). Prove you can integrate sensors suitable for you monitoring purpose.  Focus on effectiveness, namely doing the right things, i.e., the Maker approach.</p>"},{"location":"IoT/session2/#the-reference-hardware-esp32-devkit","title":"The reference hardware: ESP32-DevKit","text":""},{"location":"IoT/session2/#lets-start-by-simulating-it","title":"Let's start by simulating it","text":"<p>Wokwi is an online Electronics simulator. You can use it to simulate Arduino, ESP32, STM32, and many other popular boards, parts and sensors.</p> <p>Open a new project and select ESP32 as the platform and the Arduino template. </p> <p>If you now open the diagram.json tab you have something like the following in the parts entry</p> <pre><code>\"parts\": [ { \"type\": \"board-esp32-devkit-c-v4\", \"id\": \"esp\", ...} ],\n</code></pre> <p>This implies that the pinout is the one in the devkit v4.  To get the same pinout as the one in the picture above you need a V1 devkit, so you have to modify the entry as in the following</p> <pre><code>\"parts\": [ { \"type\": \"board-esp32-devkit-v1\", \"id\": \"esp\", ...} ],\n</code></pre> <p>To make running the serial interface be sure that under connection you have th following settings</p> <pre><code>\"connections\": [\n    [ \"esp:TX0\", \"$serialMonitor:RX\", \"\", [] ],\n    [ \"esp:RX0\", \"$serialMonitor:TX\", \"\", [] ],\n    .....\n</code></pre> <ul> <li>The simplest actuator, namely a led</li> </ul>"},{"location":"IoT/session2/#understanding-the-breadboard","title":"Understanding the Breadboard","text":"<ul> <li>The Simplest sensor, namely a button</li> <li>A bit more interesting sensor, namely a potentiometer</li> <li>A simple example with SR04 Ultrasonic Sensor. The width is measured by the function pulseIn().</li> </ul> <ul> <li>A nice example with the MPU6050 accelerometer and gyroscope. Predictive Maintenance of Motors using Machine Learning. Ensemble Learning for Predictive Maintenance on Wafer Stick Machine Using IoT Sensor Data</li> </ul>"},{"location":"IoT/session2/#a-simple-scenario","title":"A simple scenario","text":"<p>You want to transform a door into a smart door.</p> <ol> <li>A sensor will tell you when the door is open or closed \u2192 button</li> <li>A visual indicator will clearly show whether the door is open or closed \u2192 led</li> <li>Instead of a simple binary condition open/close you also want to know to what extent the door is open \u2192 potentiometer</li> </ol>"},{"location":"IoT/session2/#mqtt","title":"MQTT","text":"<p>Publish/Subscribe </p> <p></p> <p>TOPICS:</p> <ol> <li>myhome/groundfloor/livingroom/temperature</li> <li>myhome/groundfloor/bathroom/temperature</li> <li>myhome/groundfloor/bathroom/humidity</li> <li>myhome/firstfloor/bathroom/temperature</li> <li>myhome/groundfloor/+/temperature (1 and 2)</li> <li>myhome/groundfloor/# (1,2 and 3)</li> <li> <p>myhome/# (1,2,3 and 4)</p> </li> <li> <p>It's time to be connected by MQTT. The most convenient way is to use your mobile an Access Point and configure SSID and password consequently.</p> </li> </ol> <p>Note that the topics names are assigned to be consistent with the adafruit dashboard (see example below), but you are free to use any name you like.</p> <pre><code>mosquitto_pub -h test.mosquitto.org -t \"avitaletti/feeds/threshold\" -m 2345\n</code></pre> <pre><code>mosquitto_sub -h test.mosquitto.org -t \"avitaletti/feeds/potentiometer\"\n</code></pre> <p>Tip</p> <ul> <li>A multi platform easy to use alternative is https://mqtt-explorer.com/</li> <li>Another possible broker is mqtt://mqtt.eclipseprojects.io</li> </ul>"},{"location":"IoT/session2/#build-a-simple-backend-with-httpsioadafruitcom","title":"Build a simple backend with https://io.adafruit.com/","text":"<ul> <li>Create an account on io.adafruit.com, in my case the username is avitaletti.</li> <li>Click on the yellow key to get yor credentials to publish data</li> </ul> <p><pre><code>#define IO_USERNAME  \"avitaletti\"\n#define IO_KEY       \"xxxxxxxxxxxxxxxxxxxx\"\n</code></pre> * Create two feeds named threshold and potentiometer with the corresponding topics avitaletti/feeds/threshold  and avitaletti/feeds/potentiometer</p> <p></p> <p>The following code will publish the message 33 on the topic avitaletti/feeds/potentiometer and it is used by the IoT device to send the data acquired by the ADC</p> <pre><code>mosquitto_pub -h io.adafruit.com -u avitaletti -P xxxxxxxxxxxxxxxxxxxx -t avitaletti/feeds/potentiometer -m 33\n</code></pre> <p>The node can subscribe to avitaletti/feeds/threshold  to get the commands from the backend</p> <pre><code>mosquitto_sub -h io.adafruit.com -u avitaletti -P xxxxxxxxxxxxxxxxxxxx -t avitaletti/feeds/threshold\n</code></pre> <ul> <li>The dashboard link the components to the feeds and corresponding topics</li> </ul> <p></p> <p>In other words when the device publishes on the avitaletti/feeds/potentiometer topic a new entry is created in the line chart, while when you move the slider the corresponding value is published on avitaletti/feeds/threshold</p>"},{"location":"IoT/session2/#build-a-simple-backend-with-thingsboard-httpsdemothingsboardiologin","title":"Build a simple backend with thingsboard https://demo.thingsboard.io/login","text":"<p>https://thingsboard.io/docs/getting-started-guides/helloworld/?connectdevice=mqtt-linux</p> <pre><code>mosquitto_pub -d -q 1 -h \"$THINGSBOARD_HOST_NAME\" -p \"1883\" -t \"v1/devices/me/telemetry\" -u \"$ACCESS_TOKEN\" -m {\"temperature\":25}\n</code></pre> <p>NOTE: for the sake of convenience, we will use WiFi connectivity, however it should be now clear WiFi is usually not appropriate for IoT applications due to the excessive energy demand. </p>"},{"location":"IoT/session2/#it-is-time-to-work-with-a-real-device","title":"It is time to Work with a real device","text":"<ul> <li>Download the code from Wokwi. It is also available on https://github.com/andreavitaletti/IoT_short_course/tree/main/src/simulator</li> <li>The easiest way it to use the Arduino IDE </li> <li>Since we are using the ESP32, you have to follow these intructions</li> <li>Select the DOIT ESP32 DEVKIT V1 as in the picture below and upload the code</li> </ul> <ul> <li>The only novelty is the vibration sensor SW-420 ... but please have a look to the SR04 Ultrasonic Sensor and adapt it to make it working with the SW-420. </li> </ul> <p>This sketch could help</p> <pre><code>// Watch video here: https://www.youtube.com/watch?v=235BLk7vk00\n\n/* Vibration sensor connected to Arduino pins as follows:\n\n ESP32 Arduino Vibration Sensor\n https://wolles-elektronikkiste.de/esp32-mit-arduino-code-programmieren\n   D18 --&gt; GPIO18 --&gt; G18        DOut\n   GND                           GND\n   +5V --&gt; 3.3V                  VCC      \n*/\n\nint EP = 18;\n\nvoid setup(){\n  pinMode(EP, INPUT); //set EP input for measurment\n  Serial.begin(9600); //init serial 9600\n}\nvoid loop(){\n  long measurement =TP_init();\n  delay(50);\n  Serial.println(measurement);\n}\n\nlong TP_init(){\n  delay(10);\n  long measurement=pulseIn (EP, HIGH);  //wait for the pin to get HIGH and returns measurement\n  return measurement;\n}\n</code></pre> <p>Through pulseIn() we can measure the duration of a vibration event exceeding the threshold, not the frequency of the vibrations themselves. Indeed, the Arduino pulseIn() function waits for a change in the binary input (Low to High in this instance) and returns the duration that the detected pulse was active (time for it to go back High to Low after going High).</p> <p>QUESTION: Can we use this function to help in anomaly detection? see here for inspiration!</p> <p></p>"},{"location":"IoT/session3/","title":"SESSION 3","text":"<p>GOAL: Small experiment (a single sensor). Focus on efficiency, namely doing the things right, i.e., the Engineers approach. Use metrics to measure to what extent your solution satisfies the user requirements.</p> <p>Well, to develop an IoT application as an engineer, we do need a Real-Time Operating System (RTOS). What is An RTOS?. </p> <p>Embedded systems often have real time requirements. A real time requirements is one that specifies that the embedded system must respond to a certain event within a strictly defined time (the deadline). A guarantee to meet real time requirements can only be made if the behaviour of the operating system's scheduler can be predicted (and is therefore deterministic). FreeRTOS, achieve determinism by allowing the user to assign a priority to each thread of execution. The scheduler then uses the priority to know which thread of execution to run next. In FreeRTOS, a thread of execution is called a task.</p> <p>Here there is a nice explanation of the main features provided by FreeRTOS, namely </p> <ul> <li>Multitasking</li> <li>Scheduling</li> <li>Context Switching</li> <li>Real Time Applications</li> <li>Real Time Scheduling</li> </ul> <p>FreeRTOS FAQ - What is This All About?</p> <p>Finally a nice example of the design of a real-time application </p> <p>A book on FreeRTOS.</p>"},{"location":"IoT/session3/#development-environment","title":"Development environment","text":"<p>To develop our solution on our ESP32, we need to setup the environment as described here. A very convenient way is to use docker as explained here. </p> <p>To further simplify the development process, a multi-platform Virtualbox image is available here. Next we will focus on this method. Credentials to work with the virtual machine are root/root and devel/devel and we will connect in ssh as explained below. </p> <p>The reference folder for the code and the examples is https://github.com/espressif/esp-idf.git which is already available on the virtual machine on </p> <ol> <li><code>ssh devel@localhost -p 2222</code> ... the password is devel</li> <li><code>get_idf</code> ... we set up the development environment</li> <li><code>cd ~/esp</code></li> <li><code>cp -r ./esp-idf/examples/get-started/hello_world/ ./workshop/</code> ... make a copy of a dir in the example in the workshop dir </li> <li><code>cd ./workshop/hello_world/</code></li> <li><code>idf.py build</code> ... i t takes some time</li> <li><code>idf.py flash</code> ... be sure the ESP32 is connected to \\dev\\ttyUSB0 and check it is visible in the virtual machine</li> <li><code>idf.py monitor</code> ... to exit from the monitor ctrl+T ctrl+X</li> </ol> <p>NOTE in some cases you can configure specific parameters running idf.py menuconfig</p> <p>In the virtual machine you have first to  <code>export LC_ALL=C</code></p>"},{"location":"IoT/session3/#clone-only-the-relevant-code","title":"Clone only the relevant code","text":"<pre><code># Create a directory, so Git doesn't get messy, and enter it\nmkdir code_from_git &amp;&amp; cd code_from_git\n\n# Start a Git repository\ngit init\n\n# Track repository, do not enter subdirectory\ngit remote add -f origin https://github.com/andreavitaletti/IoT_short_course\n\n# Enable the tree check feature\ngit config core.sparseCheckout true\n\n# Create a file in the path: .git/info/sparse-checkout\n# That is inside the hidden .git directory that was created\n# by running the command: git init\n# And inside it enter the name of the sub directory you only want to clone\necho 'src/freertos' &gt;&gt; .git/info/sparse-checkout\n\n## Download with pull, not clone\ngit pull origin main\n</code></pre>"},{"location":"IoT/session3/#a-quick-introduction-to-tasks","title":"A quick introduction to tasks","text":"<p>Based on ESP32 ESP-IDF FreeRTOS Tutorial: Learn to Create Tasks. The code is available on our github repo</p>"},{"location":"IoT/session3/#the-examples-of-session-2-on-freertos","title":"The examples of SESSION 2 on FreeRTOS","text":"<p>In this section we will implement the reference examples developed in day2 into FreeRTOS. The idea is to take inspiration from the examples available at https://github.com/espressif/esp-idf/tree/master/examples and modify them to get the same behavior of the ones developed in DAY2</p> <ul> <li>The simplest actuator, namely a led</li> <li>The Simplest sensor, namely a button</li> <li>A bit more interesting sensor, namely a potentiometer</li> <li>A simple example with SR04 Ultrasonic Sensor</li> <li>It's time to be connected by MQTT</li> <li>About the vibration sensor SW-420 ... have a look here</li> </ul> <p>Nice tutorials on the same topics are also available here</p>"},{"location":"IoT/session3/#data-streaming-in-industrial-iot","title":"Data Streaming in Industrial IoT","text":"<ul> <li>MQTT</li> <li>OPCUA</li> <li>Apache Kafka</li> </ul>"},{"location":"IoT/session4/","title":"SESSION 4","text":"<p>GOAL: Scale-up in a realistic environment.</p> <p>IoT-LAB provides a very large scale infrastructure suitable for testing small wireless sensor devices and heterogeneous communicating objects.</p> <p>Even if the ESP32 is not currently among the supported hardware, IoT-LAB supports FreeRTOS.</p> <ul> <li>Once you have setup a user connect to a lab by ssh, as an example</li> </ul> <pre><code>ssh vitalett@grenoble.iot-lab.info\n</code></pre> <ul> <li>Follow the instructions here to run FreeRTOS on IoT-LAB</li> <li>The reference code is available on https://github.com/iot-lab/openlab and in particular we are inetrested in the tutorial</li> <li>Once the code has been compiled, it can run into an experiment as explained here</li> <li>A quite unique feature, is the ability to perform consuption monitoring as explained here. To plot the graphs, download the oml files and use the following tools</li> </ul>"},{"location":"IoT/supplement1/","title":"Tensorflow Lite Micro on ESP32","text":"<p>Reference examples are available here. You have to download from github esp-nn and esp32-camera and place them into the relative folders under components.</p> <p>Then go to examples/hello_worlds and as usual idf.py build, idf.py flash and finally idf.py monitor.</p> <p>A nice explanation on how the model is generated can be found on the book TinyML by Pete Warden, Daniel Situnayake. The corresponding jupyter notebook is available here</p> <p>Some other useful resources are listed below:</p> <ul> <li>First steps with ESP32 and TensorFlow Lite for Microcontrollers</li> <li>Get started with microcontrollers</li> </ul>"},{"location":"IoT/supplement2/","title":"Kalman Filters","text":"<p>A very nice, rich an exhaustive source of documentation for Kalman filters is available here</p> <p>The main idea is that both our prior knowledge and the measurements of our sensors are to some extent inaccurate. To model such inaccuracy we use a Gaussian with mean $$\\mu$$ and variance $$\\rho$$</p> <p></p> <p>At each iteration we have our prior knowledge (in blue) and a new measurement (in orange) and we account for both source of information computing an average (in green)</p> <p></p> <p>The final mean gets shifted which is in between the two old means, the mean of the prior, and the mean of the measurement. It\u2019s slightly further on the measurement side because the measurement was more certain as to where the vehicle is than prior. The more certain we are, the more we pull the mean on the direction of the certain answer. source</p> <p>Iteration after iteration the variance decreases (the spread of the blue gaussian), providing a better estimation (in green) despite the noisy measurements (in red) source</p> <p></p> <p>A reference library is available here</p>"},{"location":"IoT/supplement3/","title":"Interact with a Mobile Phone via BLE","text":"<p>We aim at fast prototyping and Thunkable is an excellent tool</p> <p></p> <p>The arduino code, adapted from https://www.instructables.com/ESP32-BLE-Android-App-Arduino-IDE-AWESOME/ is the following</p> <pre><code>/*\n    Video: https://www.youtube.com/watch?v=oCMOYS71NIU\n    Based on Neil Kolban example for IDF: https://github.com/nkolban/esp32-snippets/blob/master/cpp_utils/tests/BLE%20Tests/SampleNotify.cpp\n    Ported to Arduino ESP32 by Evandro Copercini\n\n   Create a BLE server that, once we receive a connection, will send periodic notifications.\n   The service advertises itself as: 6E400001-B5A3-F393-E0A9-E50E24DCCA9E\n   Has a characteristic of: 6E400002-B5A3-F393-E0A9-E50E24DCCA9E - used for receiving data with \"WRITE\" \n   Has a characteristic of: 6E400003-B5A3-F393-E0A9-E50E24DCCA9E - used to send data with  \"NOTIFY\"\n\n   The design of creating the BLE server is:\n   1. Create a BLE Server\n   2. Create a BLE Service\n   3. Create a BLE Characteristic on the Service\n   4. Create a BLE Descriptor on the characteristic\n   5. Start the service.\n   6. Start advertising.\n\n   In this example rxValue is the data received (only accessible inside that function).\n   And txValue is the data to be sent, in this example just a byte incremented every second. \n*/\n#include &lt;BLEDevice.h&gt;\n#include &lt;BLEServer.h&gt;\n#include &lt;BLEUtils.h&gt;\n#include &lt;BLE2902.h&gt;\n\n// 78:21:84:9f:24:de\n\nBLECharacteristic *pCharacteristic;\nbool deviceConnected = false;\nfloat txValue = 0;\nconst int readPin = 32; // Use GPIO number. See ESP32 board pinouts\n//const int LED = 9; // Could be different depending on the dev board. I used the DOIT ESP32 dev board.\n\n//std::string rxValue; // Could also make this a global var to access it in loop()\n\n// See the following for generating UUIDs:\n// https://www.uuidgenerator.net/\n\n#define SERVICE_UUID           \"6E400001-B5A3-F393-E0A9-E50E24DCCA9E\" // UART service UUID\n#define CHARACTERISTIC_UUID_RX \"6E400002-B5A3-F393-E0A9-E50E24DCCA9E\" // Qui ricevi da EPS32\n#define CHARACTERISTIC_UUID_TX \"6E400003-B5A3-F393-E0A9-E50E24DCCA9E\" // Qui invii\n\nclass MyServerCallbacks: public BLEServerCallbacks {\n    void onConnect(BLEServer* pServer) {\n      deviceConnected = true;\n    };\n\n    void onDisconnect(BLEServer* pServer) {\n      deviceConnected = false;\n    }\n};\n\n\n\nclass MyCallbacks: public BLECharacteristicCallbacks {\n    void onWrite(BLECharacteristic *pCharacteristic) {\n      std::string rxValue = pCharacteristic-&gt;getValue();\n\n      char letto[] = \"          \";\n\n      if (rxValue.length() &gt; 0) {\n        Serial.println(\"*********\");\n        Serial.print(\"Received Value: \");\n\n        for (int i = 0; i &lt; rxValue.length(); i++) {\n          Serial.print(rxValue[i]);\n          letto[i]=rxValue[i];\n        }\n\n        Serial.println();\n\n        String a = String(letto);\n\n        Serial.print(a.toFloat());\n\n        // Do stuff based on the command received from the app\n        if (rxValue.find(\"A\") != -1) { \n          Serial.print(\"Turning ON!\");\n          digitalWrite(LED, HIGH);\n        }\n        else if (rxValue.find(\"B\") != -1) {\n          Serial.print(\"Turning OFF!\");\n          digitalWrite(LED, LOW);\n        }\n\n        Serial.println();\n        Serial.println(\"*********\");\n      }\n    }\n};\n\nvoid setup() {\n  Serial.begin(115200);\n\n  pinMode(LED, OUTPUT);\n\n  // Create the BLE Device\n  BLEDevice::init(\"ESP32 UART Test\"); // Give it a name\n\n  Serial.print(\"local BLE Address is: \");\n  Serial.println(BLEDevice::getAddress().toString().c_str());\n\n  // Create the BLE Server\n  BLEServer *pServer = BLEDevice::createServer();\n  pServer-&gt;setCallbacks(new MyServerCallbacks());\n\n  // Create the BLE Service\n  BLEService *pService = pServer-&gt;createService(SERVICE_UUID);\n\n\n  // BleCharacteristic deviceHealthCharacteristic(\"deviceHealth\", BleCharacteristicProperty::READ, deviceHealthUuid, serviceUuid);\n  // see https://community.thunkable.com/t/ble-hrm-reading-bpm/2441754/6\n\n\n  // Create a BLE Characteristic\n  pCharacteristic = pService-&gt;createCharacteristic(\n                      CHARACTERISTIC_UUID_TX,\n                      //BLECharacteristic::PROPERTY_NOTIFY\n                      BLECharacteristic::PROPERTY_READ\n                    );\n\n  pCharacteristic-&gt;addDescriptor(new BLE2902());\n\n  BLECharacteristic *pCharacteristic = pService-&gt;createCharacteristic(\n                                         CHARACTERISTIC_UUID_RX,\n                                         BLECharacteristic::PROPERTY_WRITE\n                                       );\n\n  pCharacteristic-&gt;setCallbacks(new MyCallbacks());\n\n  // Start the service\n  pService-&gt;start();\n\n  // Start advertising\n  pServer-&gt;getAdvertising()-&gt;start();\n  Serial.println(\"Waiting a client connection to notify...\");\n}\n\nvoid loop() {\n\n  if (deviceConnected) {\n    // Fabricate some arbitrary junk for now...\n    txValue = analogRead(readPin) / 3.456; // This could be an actual sensor reading!\n\n    // Let's convert the value to a char array:\n    char txString[8]; // make sure this is big enuffz\n    dtostrf(txValue, 1, 2, txString); // float_val, min_width, digits_after_decimal, char_buffer\n\n//    pCharacteristic-&gt;setValue(&amp;txValue, 1); // To send the integer value\n    pCharacteristic-&gt;setValue(\"Hello!\"); // Sending a test message\n    //pCharacteristic-&gt;setValue(txString);\n\n    pCharacteristic-&gt;notify(); // Send the value to the app!\n    Serial.print(\"*** Sent Value: \");\n    Serial.print(txString);\n    Serial.println(\" ***\");\n\n    // You can add the rxValue checks down here instead\n    // if you set \"rxValue\" as a global var at the top!\n    // Note you will have to delete \"std::string\" declaration\n    // of \"rxValue\" in the callback function.\n//    if (rxValue.find(\"A\") != -1) { \n//      Serial.println(\"Turning ON!\");\n//      digitalWrite(LED, HIGH);\n//    }\n//    else if (rxValue.find(\"B\") != -1) {\n//      Serial.println(\"Turning OFF!\");\n//      digitalWrite(LED, LOW);\n//    }\n  }\n\n  delay(1000);\n}\n</code></pre> <pre><code>// Adapted from https://github.com/SIMS-IOT-Devices/FreeRTOS-ESP-IDF-BLE-Server\n\n#include &lt;stdio.h&gt;\n#include \"freertos/FreeRTOS.h\"\n#include \"freertos/task.h\"\n#include \"freertos/event_groups.h\"\n#include \"esp_event.h\"\n#include \"nvs_flash.h\"\n#include \"esp_log.h\"\n#include \"esp_nimble_hci.h\"\n#include \"nimble/nimble_port.h\"\n#include \"nimble/nimble_port_freertos.h\"\n#include \"host/ble_hs.h\"\n#include \"services/gap/ble_svc_gap.h\"\n#include \"services/gatt/ble_svc_gatt.h\"\n#include \"sdkconfig.h\"\n\nchar *TAG = \"BLE-Server\";\nuint8_t ble_addr_type;\nvoid ble_app_advertise(void);\n\n//@_____________________Define UUIDs______________________________________\n//!! b2bbc642-46da-11ed-b878-0242ac120002\n//static const ble_uuid128_t gatt_svr_svc_uuid =\n//    BLE_UUID128_INIT(0x02, 0x00, 0x12, 0xac, 0x42, 0x02, 0x78, 0xb8, 0xed, 0x11, 0xda, 0x46, 0x42, 0xc6, 0xbb, 0xb2);\n\nstatic const ble_uuid128_t gatt_svr_svc_uuid =\n    BLE_UUID128_INIT(0x9e, 0xca, 0xdc, 0x24, 0x0e, 0xe5, 0xa9, 0xe0, 0x93, 0xf3, 0xa3, 0xb5, 0x01, 0x00, 0x40, 0x6e);\n\n\n//!! c9af9c76-46de-11ed-b878-0242ac120002\n//static const ble_uuid128_t gatt_svr_chr_uuid =\n//    BLE_UUID128_INIT(0x02, 0x00, 0x12, 0xac, 0x42, 0x02, 0x78, 0xb8, 0xed, 0x11, 0xde, 0x46, 0x76, 0x9c, 0xaf, 0xc9);\n\n// 6E400002-B5A3-F393-E0A9-E50E24DCCA9E    \n\nstatic const ble_uuid128_t gatt_svr_chr_read_uuid =\n    BLE_UUID128_INIT(0x9e, 0xca, 0xdc, 0x24, 0x0e, 0xe5, 0xa9, 0xe0, 0x93, 0xf3, 0xa3, 0xb5, 0x02, 0x00, 0x40, 0x6e);\nstatic const ble_uuid128_t gatt_svr_chr_write_uuid =\n    BLE_UUID128_INIT(0x9e, 0xca, 0xdc, 0x24, 0x0e, 0xe5, 0xa9, 0xe0, 0x93, 0xf3, 0xa3, 0xb5, 0x03, 0x00, 0x40, 0x6e);\n\n\n// Write data to ESP32 defined as server\nstatic int device_write(uint16_t conn_handle, uint16_t attr_handle, struct ble_gatt_access_ctxt *ctxt, void *arg)\n{\n    printf(\"Data from the client: %.*s\\n\", ctxt-&gt;om-&gt;om_len, ctxt-&gt;om-&gt;om_data);\n    return 0;\n}\n\n// Read data from ESP32 defined as server\nstatic int device_read(uint16_t con_handle, uint16_t attr_handle, struct ble_gatt_access_ctxt *ctxt, void *arg)\n{\n    os_mbuf_append(ctxt-&gt;om, \"Data from the server\", strlen(\"Data from the server\"));\n    return 0;\n}\n\nstatic const struct ble_gatt_svc_def gatt_svcs[] = {\n    {.type = BLE_GATT_SVC_TYPE_PRIMARY,\n     .uuid = &amp;gatt_svr_svc_uuid.u,                      // Define UUID for device type\n     .characteristics = (struct ble_gatt_chr_def[]){\n         {.uuid = &amp;gatt_svr_chr_write_uuid.u,           // Define UUID for reading\n          .flags = BLE_GATT_CHR_F_READ,\n          .access_cb = device_read},\n         {.uuid = &amp;gatt_svr_chr_read_uuid.u,           // Define UUID for writing\n          .flags = BLE_GATT_CHR_F_WRITE,\n          .access_cb = device_write},\n         {0}}},\n    {0}};\n\n\n\n// BLE event handling\nstatic int ble_gap_event(struct ble_gap_event *event, void *arg)\n{\n    switch (event-&gt;type)\n    {\n    // Advertise if connected\n    case BLE_GAP_EVENT_CONNECT:\n        ESP_LOGI(\"GAP\", \"BLE GAP EVENT CONNECT %s\", event-&gt;connect.status == 0 ? \"OK!\" : \"FAILED!\");\n        if (event-&gt;connect.status != 0)\n        {\n            ble_app_advertise();\n        }\n        break;\n    // Advertise again after completion of the event\n    case BLE_GAP_EVENT_ADV_COMPLETE:\n        ESP_LOGI(\"GAP\", \"BLE GAP EVENT\");\n        ble_app_advertise();\n        break;\n    default:\n        break;\n    }\n    return 0;\n}\n\n// Define the BLE connection\nvoid ble_app_advertise(void)\n{\n    // GAP - device name definition\n    struct ble_hs_adv_fields fields;\n    const char *device_name;\n    memset(&amp;fields, 0, sizeof(fields));\n    device_name = ble_svc_gap_device_name(); // Read the BLE device name\n    fields.name = (uint8_t *)device_name;\n    fields.name_len = strlen(device_name);\n    fields.name_is_complete = 1;\n    ble_gap_adv_set_fields(&amp;fields);\n\n    // GAP - device connectivity definition\n    struct ble_gap_adv_params adv_params;\n    memset(&amp;adv_params, 0, sizeof(adv_params));\n    adv_params.conn_mode = BLE_GAP_CONN_MODE_UND; // connectable or non-connectable\n    adv_params.disc_mode = BLE_GAP_DISC_MODE_GEN; // discoverable or non-discoverable\n    ble_gap_adv_start(ble_addr_type, NULL, BLE_HS_FOREVER, &amp;adv_params, ble_gap_event, NULL);\n}\n\n// The application\nvoid ble_app_on_sync(void)\n{\n    ble_hs_id_infer_auto(0, &amp;ble_addr_type); // Determines the best address type automatically\n    ble_app_advertise();                     // Define the BLE connection\n}\n\n// The infinite task\nvoid host_task(void *param)\n{\n    nimble_port_run(); // This function will return only when nimble_port_stop() is executed\n}\n\nvoid app_main()\n{\n    nvs_flash_init();                          // 1 - Initialize NVS flash using\n    //esp_nimble_hci_and_controller_init();      // 2 - Initialize ESP controller\n    nimble_port_init();                        // 3 - Initialize the host stack\n    ble_svc_gap_device_name_set(\"BLE-Server\"); // 4 - Initialize NimBLE configuration - server name\n    ble_svc_gap_init();                        // 4 - Initialize NimBLE configuration - gap service\n    ble_svc_gatt_init();                       // 4 - Initialize NimBLE configuration - gatt service\n    ble_gatts_count_cfg(gatt_svcs);            // 4 - Initialize NimBLE configuration - config gatt services\n    ble_gatts_add_svcs(gatt_svcs);             // 4 - Initialize NimBLE configuration - queues gatt services.\n    ble_hs_cfg.sync_cb = ble_app_on_sync;      // 5 - Initialize application\n    nimble_port_freertos_init(host_task);      // 6 - Run the thread\n}\n</code></pre>"},{"location":"IoT/supplement4/","title":"From Wokwi to a real device","text":"<ol> <li>Compile the code and on the code editor press F1 to download the firmware. It is a .bin file, let's name it sketch.bin file </li> <li> <p><code>esptool.py --chip esp32 --port \"/dev/ttyUSB0\" --baud 921600  --before default_reset --after hard_reset write_flash  -z --flash_mode keep --flash_freq keep --flash_size keep 0x1000 \"bootloader.bin\" 0x8000 \"partitions.bin\" 0xe000 \"boot_app0.bin\" 0x10000 \"sketch.bin\"</code> Once partitions and bootloader are uploaded, you can simply upload the sketch. To upload for the first time the partitions and the bootloader you can simply used arduino IDE </p> </li> <li> <p><code>esptool.py --chip esp32 --port \"/dev/ttyUSB0\" --baud 921600  --before default_reset --after hard_reset write_flash  -z --flash_mode keep --flash_freq keep --flash_size keep 0x10000 ./sketch.bin</code></p> </li> </ol> <p>In principle you can even use a Web tool</p>"},{"location":"IoT/supplement4/#partition-table","title":"Partition Table","text":"# Name Type SubType Offset Size Flags nvs data nvs 0x9000 0x5000 otadata data ota 0xe000 0x2000 app0 app ota_0 0x10000 0x140000 app1 app ota_1 0x150000 0x140000 spiffs data spiffs 0x290000 0x160000 coredump data coredump 0x3F0000 0x10000"},{"location":"Startup/","title":"Entrepreneurship","text":"<p>https://sites.google.com/diag.uniroma1.it/digital-entrepreneurship/home</p>"}]}